[TOC]

## tcp
http是一个控制如何书写内容的协议;
tcp是控制如何传输的协议;


1.  [TCP 和 UDP 的区别是什么](https://www.nowcoder.com/questionTerminal/63c8b45c91a544bd8febc1f1ff02e3b5?toCommentId=73766 "null")
    简答：TCP 可靠(有没有连接上都会知道)、面向连接、相对 UDP 较慢；UDP 不可靠，不面向连接、相对 TCP 较快。搞定。
2.  [TCP 的三次握手指的是什么](https://github.com/jawil/blog/issues/14 "null")
    简答：每次建立连接前，客户端和服务端之前都要先进行三次对话才开始正式传输内容，三次对话大概是这样的：
    

    
     1\. 客户端：我要连接你了，可以吗
     2\. 服务端：嗯，我准备好了，连接我吧
     3\. 客户端：那我连接你咯。
     4\. 开始后面步骤
    
有关三次握手的理解:
为了准确无误地将数据送达目标处， TCP 协议采用了三次握手
（three-way handshaking） 策略。 用 TCP 协议把数据包送出去后， TCP不会对传送后的情况置之不理， 它一定会向对方确认是否成功送达;

握手过程中使用了 TCP 的标志（flag）-SYN（synchronize） 和
ACK（acknowledgement） 。

发送端首先发送一个带 SYN 标志的数据包给对方。 接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。 最后， 发
送端再回传一个带 ACK 标志的数据包， 代表“握手”结束。

若在握手过程中某个阶段莫名中断， TCP 协议会再次以相同的顺序发送相同的数据包。

![]((7)Node.js.server_files/e9c0471d-3ac9-425a-944c-a727c8cbda88.jpg)


## ip
在网中的重要节点处称为网关(下面讲路由的时候有讲到;)
*   你从电信那里买来带宽，一年一千多。
*   电信为你提供 DNS 服务。
*   你买了一个路由器，然后用电脑和手机分别连接路由器广播出来的无线 WIFI。
* 只要路由器连上电信的服务器，那么路由器就会有一个「外网 IP」，比如「14.17.32.211」就是一个外网 IP。这就是你在互联网中的地址。
*   但是如果你重启路由器，那么你很有「可能」被重新分配一个「外网 IP」，也就是说 **你的路由器没有「固定的外网 IP」**

*   你可以花每年几千块钱租用一个「固定的外网 IP」，但是显然不会这么浪费钱。像腾讯、阿里这样的大公司租用了很多外网 IP，这样才能对我们提供稳定的服务。

*   但是有个问题，你的路由器的外网 IP 如果是14.17.32.211，那么你的手机和电脑的 IP 又是什么呢？答案是「内网 IP」

*   路由器会在你家里创建一个内网，内网中的设备使用内网 IP，一般来说这个 IP 的格式都是 192.168.xxx.xxx。
    *   一般路由会给自己分配一个好记的内网 IP，如 192.168.1.1
    *   然后路由会给每一个内网中的设备分配一个不同的内网 IP，如电脑是 192.168.1.2，手机是 192.168.1.3，以此类推。
    *   现在路由器有两个 IP，一个外网 IP（14.17.32.211）和一个内网 IP（192.168.1.1）
        *   内网中的设备可以互相访问（比如你可以用电脑或手机进入 [http://192.168.1.1](http://192.168.1.1/ "null") 来查看你的路由器），但是不能**直接**访问外网，内网设备想要访问外网，就必须经过路由器中转。
        *   外网中的设备可以互相访问（比如 qq.com 可以把首页发送给你的路由器，你的路由器有外网 IP），但是外网中的设备无法访问你的内网设备（这很好理解，内网是一个封闭的网络，外人进不来，所以实际上 qq.com 无法直接把首页放送给你的电脑和手机）
            *   问题来了，那 qq.com 是怎么把首页发送到我的手机上的呢？答案是通过路由器来中转。
            *   路由器接收到 qq.com 的页面后，把页面发送给你的电脑或手机。路由器知道如何给这些信息**指路**，路由器就是一个指路人，这就是「路由」两个字的来历。
            *   路，就是「必由之路」中的路。由，就是「必由之路」中的由（由是经过、缘由的意思）。所有的信息都要经过路由器，然后被指向一条它该去的路。
        *   也就是说内网和外网就像两个隔绝的空间，无法互通，唯一的联通点就是路由器（因为路由器既有外网 IP 也有内网 IP），所以路由器有时候也被叫做「网关」，这个「关」是「一夫当关，万夫莫开」的「关」。如果路由器到电信的连接中断了，那么内网中所有的设备也就无法上网了。（这很好理解，相当于唯一一条出去的路断了）
*   除了内网 IP 和外网 IP，还有两个特别特殊的 IP，就是本地 IP：127.0.0.1。本地 IP 永远表示设备自己。不信你可以 ping 127.0.0.1 一下，会发现只需要 0.01 ms 就得到了响应（你 ping qq.com 需要几十毫秒才得到响应）
    *   默认情况下，hosts 文件里会有一行`127.0.0.1 localhost`，意思就是 localhost 指向 127.0.0.1，所以 localhost 也表示设备自己。不信你 ping localhost 试试，会发现实际上是在 ping 127.0.0.1
*   还有一个特别特殊的 IP：0.0.0.0，它不表示任何设备。这个 IP 不同的地方含义不同，以后我们会用到，用到的时候再说意思。

## 端口

你想要访问一个设备（前提是你使用的是 TCP 或 UDP 协议。还记得吗，HTTP 就使用了 TCP），只指定 IP 是不够的，还**必须**指定端口（Port）。

端口其实就是一个编号，并不是一种硬件。

一个服务器（硬件）不一定只提供一种服务，比如一个服务器既提供 HTTP 服务，又提供 FTP 服务，还提供 SMTP 服务（邮件服务），那么只用一个 IP 是无法告诉服务器你想要使用哪种服务。

所以这里有一个重要的原则：一个端口对应一个服务。

比如

1.  要提供 HTTP 服务你最好使用 80 端口（能不能使用别的端口？可以，不过不建议你违反约定）
2.  要提供 HTTPS 服务你最好使用 443 端口（能不能使用别的端口？可以，不过不建议你违反约定）
3.  要提供 FTP 服务你最好使用 21 端口（能不能使用别的端口？可以，不过不建议你违反约定）

### 问题1：我怎么知道应该使用什么端口？

[维基百科](https://zh.wikipedia.org/wiki/TCP/UDP%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8#0.E5.88.B01023.E5.8F.B7.E7.AB.AF.E5.8F.A3 "null") 把 0 到 1023 号端口对应的服务都告诉你了，点进去看看吧。

### 问题2：一共由多少端口？

每个机器一共有 65535（2的16次方减1）个端口（这是协议规定的）。不过这些端口的使用由一些规定

1.  0 到 1023（2的10次方减1）号端口是留给系统使用的，你只有拥有了管理员权限后，才能使用这 1024 个端口。
2.  其他端口可以给普通用户使用
3.  如果一个端口正在提供服务，也就是被占用了，那么就不能再使用这个端口。除非你先停掉正在占用这个端口的服务。以后你们会经常遇到这个问题。

## 总结

上面都是 TCP/IP 相关的知识，如果你记不住，就记住下面这句话：

> 使用 HTTP 协议访问另一个 IP 时，必须同时提供 IP 和端口号，缺一不可。

那么问题来了

> 我访问 [http://qq.com](http://qq.com/ "null") 时并没有提供端口号，为什么我依然可以访问

答：因为**浏览器**帮你加了默认端口号 80


## 服务器简单测试
测试1:
代码见:
https://raw.githubusercontent.com/FrankFang/nodejs-test/7f1a0ce15c47a6c2c938fe322f042e5d62bc7d01/server.js
![]((7)Node.js.server_files/7da1d63f-ade2-47f4-a4c6-8182dd914346.jpg)
服务端输入`node server.js 8888`之后服务端就一直在等,一直到客户端输入:
![]((7)Node.js.server_files/d02e8c7a-12bf-4674-bb6d-5d8d0bb0093f.jpg)

![]((7)Node.js.server_files/d38ba615-a792-4553-a08b-b1c1fed68f2c.png)

注意:这里的192.168.0.104是这里的电脑主机(就是这台电脑)的ip(可以用ifconfig/ipconfig命令)








## 如何响应
respond.write('hi\n')写第四部分；
respond.end()：结束响应；

response.setHeader('Content-Type', 'text/javascript; charset=utf-8')写第二部分；


response.statusCode = 404
写第一部分；


## 总结
在浏览器里面输入网址,然后敲回车,发生了什么:
首先,浏览器会看你缺什么,缺端口号,加一个端口号，缺路径,加一个`/`;缺协议,帮你加一个http;

第一次是查询DNS，以百度为例,我想道`www.baidu.com`的ip是多少,于是浏览器向DNS发起了一次询问:电信啊,百度的Ip是多少,我想访问,好的,我给你一个真的百度Ip;

拿到这个Ip之后,浏览器向这个Ip发起了请求,请求的内容见request headers;

发了之后,**百度的这个服务器接收了这个请求,他会看一下你的路径是什么,根据路径会设置一些header(详见response.setheader()),然后返回给你一个html(利用response.write()**),然后结束(response.end()),结束之后就会把内容传给我下载;

下载完之后就把html解析出来给我们看见;边解析还要边找,看我们还有没我们请求的东西(比如png图片,gif动态图,css,js);all东西请求完了就拼给用户看；